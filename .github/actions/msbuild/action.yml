#Project uses .NET Framework 4.6.2 which is not in later Github hosted runners
# See: https://github.com/actions/runner-images/blob/main/images/windows/Windows2019-Readme.md
name: Build dll
runs-on: windows-2019

steps:
  - uses: actions/checkout@v4

  - name: Update extension.yaml
    uses: fjogeleit/yaml-update-action@main
    with:
      valueFile: 'extension.yaml'
      changes: |
        {
        "Links.Url": "${{github.server_url}}/${{github.repository}}",
        "Author": "${{github.repository_owner}}"
        }
      method: update
      message: "Metadata updated from repository"
      commitChange: true

  - name: Add msbuild to PATH
    uses: microsoft/setup-msbuild@v2

  - name: Restore NuGet packages
    working-directory: ${{env.GITHUB_WORKSPACE}}
    run: nuget restore ${{env.SOLUTION_FILE_PATH}}

  - name: Build app for release
    working-directory: ${{env.GITHUB_WORKSPACE}}
    # Add additional options to the MSBuild command line here (like platform or verbosity level).
    # See https://docs.microsoft.com/visualstudio/msbuild/msbuild-command-line-reference
    run: msbuild /m /p:Configuration=${{env.BUILD_CONFIGURATION}} ${{env.SOLUTION_FILE_PATH}} /verbosity:diag
